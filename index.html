<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TaxMate Chatbot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- cache kill -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
}
.chatbox{
  max-width:600px;
  margin:40px auto;
  background:#fff;
  border-radius:8px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}
.header{
  padding:15px;
  background:#1e3c72;
  color:#fff;
  font-weight:bold;
}
.messages{
  height:350px;
  overflow-y:auto;
  padding:15px;
}
.msg{margin-bottom:10px}
.user{text-align:right}
.bot{text-align:left}
.bubble{
  display:inline-block;
  padding:10px 14px;
  border-radius:14px;
  max-width:75%;
}
.user .bubble{background:#667eea;color:#fff}
.bot .bubble{background:#eee}
.input{
  display:flex;
  border-top:1px solid #ddd;
}
.input input{
  flex:1;
  padding:12px;
  border:none;
  outline:none;
}
.input button{
  padding:12px 20px;
  border:none;
  background:#1e3c72;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="chatbox">
  <div class="header">ğŸ‡µğŸ‡° TaxMate Chatbot</div>
  <div class="messages" id="messages">
    <div class="msg bot"><div class="bubble">Ask your tax questionâ€¦</div></div>
  </div>
  <div class="input">
    <input id="input" placeholder="Type messageâ€¦" />
    <button onclick="sendChatMessage()">Send</button>
  </div>
</div>

<script>
const WEBHOOK_URL ="https://shiningstarplay321.app.n8n.cloud/webhook-test/15de7ef6-275e-42bf-a570-81067e2bb0f7"; 
// ğŸ‘† ÛŒÛÛŒ URL n8n webhook node ÙˆØ§Ù„Ø§ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’

const messages = document.getElementById("messages");
const input = document.getElementById("input");

function addMessage(text, type){
  const div = document.createElement("div");
  div.className = "msg " + type;
  div.innerHTML = `<div class="bubble">${text}</div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

async function sendChatMessage(){
  const text = input.value.trim();
  if(!text) return;

  addMessage(text,"user");
  input.value = "";

  try{
    const res = await fetch(WEBHOOK_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ query:text })
    });

    // âš ï¸ NEVER use response.json()
    const raw = await res.text();

    if(!raw){
      addMessage("âš ï¸ Backend se empty response aaya.","bot");
      return;
    }

    let data;
    try{
      data = JSON.parse(raw);
    }catch{
      addMessage(raw,"bot");
      return;
    }

    addMessage(data.reply || "Ø¬ÙˆØ§Ø¨ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚºÛ”","bot");

  }catch(e){
    console.error(e);
    addMessage("âŒ Server reachable nahi.","bot");
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") sendChatMessage();
});
</script>

</body>
</html>
