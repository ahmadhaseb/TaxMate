<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pakistan Tax Help Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon fix -->
    <link rel="icon" href="data:,">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Poppins,sans-serif;background:#f4f6f8;color:#333}
        header{background:#1e3c72;color:#fff;padding:15px;position:fixed;width:100%;top:0;z-index:10}
        .container{max-width:1200px;margin:auto;padding:0 15px}
        .logo{font-size:20px;font-weight:600}
        .hero{margin-top:80px;padding:60px 15px;text-align:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
        .hero h1{font-size:36px;margin-bottom:10px}
        .hero p{font-size:18px}

        #chatbot{padding:60px 15px}
        .chatbox{max-width:700px;margin:auto;background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.1);overflow:hidden}
        .chat-header{background:#1e3c72;color:#fff;padding:15px;text-align:center}
        .messages{height:400px;overflow-y:auto;padding:15px;background:#f9fafb}
        .msg{display:flex;margin-bottom:10px}
        .msg.user{justify-content:flex-end}
        .bubble{max-width:70%;padding:12px 15px;border-radius:18px;font-size:14px}
        .user .bubble{background:#667eea;color:#fff}
        .bot .bubble{background:#fff;border:1px solid #ddd}
        .input-area{display:flex;border-top:1px solid #ddd}
        .input-area input{flex:1;padding:15px;border:none;outline:none}
        .input-area button{padding:15px 25px;border:none;background:#1e3c72;color:#fff;cursor:pointer}
        .input-area button:disabled{opacity:.6}

        footer{text-align:center;padding:20px;background:#1e3c72;color:#fff;margin-top:40px}
    </style>
</head>
<body>

<header>
    <div class="container logo">ðŸ‡µðŸ‡° Pakistan Tax Help Portal</div>
</header>

<section class="hero">
    <h1>Your Tax Companion</h1>
    <p>Instant help for FBR, NTN & Tax Returns</p>
</section>

<section id="chatbot">
    <div class="chatbox">
        <div class="chat-header">ðŸ’¬ Tax Help Chatbot</div>
        <div class="messages" id="chatMessages">
            <div class="msg bot">
                <div class="bubble">Welcome! Ask anything about FBR or taxes.</div>
            </div>
        </div>
        <div class="input-area">
            <input id="chatInput" placeholder="Type your question..." />
            <button id="sendBtn">Send</button>
        </div>
    </div>
</section>

<footer>
    Â© 2025 Pakistan Tax Help Portal
</footer>

<script>
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

/* ðŸ”— n8n webhook */
const WEBHOOK_URL = "https://shiningstarplay321.app.n8n.cloud/webhook/fcfeee50-f112-474c-9176-ff392d93a8a6";

function addMessage(text, type){
    const msg = document.createElement("div");
    msg.className = "msg " + type;

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    msg.appendChild(bubble);
    chatMessages.appendChild(msg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function sendChatMessage(){
    const message = chatInput.value.trim();
    if(!message) return;

    addMessage(message,"user");
    chatInput.value="";
    sendBtn.disabled=true;

    try{
        const res = await fetch(WEBHOOK_URL,{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({ query:message })
        });

        if(!res.ok) throw new Error("Server Error");

        const raw = await res.text();

        if(!raw){
            addMessage("Ø¢Ù¾ Ú©Ø§ Ø³ÙˆØ§Ù„ Ù…ÙˆØµÙˆÙ„ ÛÙˆ Ú¯ÛŒØ§ ÛÛ’ØŒ Ø¨Ø±Ø§ÛÙ Ú©Ø±Ù… Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚºÛ”","bot");
            return;
        }

        let data;
        try{
            data = JSON.parse(raw);
        }catch{
            addMessage(raw,"bot");
            return;
        }

        const reply = data.reply || data.response || data.answer || data.text || "Ø¬ÙˆØ§Ø¨ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚºÛ”";
        addMessage(reply,"bot");

    }catch(err){
        console.error(err);
        addMessage("Ø³Ø±ÙˆØ³ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚºØŒ Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”","bot");
    }finally{
        sendBtn.disabled=false;
        chatInput.focus();
    }
}

sendBtn.onclick = sendChatMessage;
chatInput.addEventListener("keypress",e=>{
    if(e.key==="Enter") sendChatMessage();
});
</script>

</body>
</html>
